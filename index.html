<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Standard IQ Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
    :root{--primary:#4361ee;--bg:#f9fafb;}
    body{font-family:'Inter','Noto Sans Arabic',sans-serif;background:linear-gradient(135deg,#f5f7fa,#c3cfe2);min-height:100vh;padding:15px;}
    [dir="rtl"]{direction:rtl;text-align:right;}
    .container{max-width:800px;margin:auto;}
    .card{border:none;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.1);overflow:hidden;margin-bottom:1rem;}
    .card-header{background:var(--primary);color:#fff;text-align:center;padding:1rem;font-weight:600;}
    .question-container{padding:1.5rem;}
    .option-btn{width:100%;text-align:left;margin-bottom:.75rem;padding:.75rem 1rem;border-radius:12px;
                border:1px solid #d1d5db;background:#fff;transition:.2s;font-size:1rem;}
    [dir="rtl"] . .option-btn{text-align:right;}
    .option-btn:hover,.option-btn.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
    .progress{height:8px;border-radius:4px;margin-bottom:1.5rem;background:#e5e7eb;}
    .progress-bar{background:var(--primary);}
    .btn-primary{background:var(--primary);border:none;border-radius:12px;padding:.75rem 1.5rem;width:100%;font-weight:600;}
    .btn-outline-secondary{width:100%;}
    .result-card{background:#fff;border-radius:16px;padding:2rem;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.1);}
    .iq-score{font-size:3.5rem;font-weight:700;color:var(--primary);}
    .question-image img{max-width:100%;border-radius:8px;margin:1rem 0;box-shadow:0 4px 8px rgba(0,0,0,.1);}
    .hidden{display:none!important;}
    .lang-selector{position:fixed;top:10px;right:10px;z-index:1000;background:#fff;border-radius:8px;padding:4px;box-shadow:0 2px 8px rgba(0,0,0,.1);}
    [dir="rtl"] .lang-selector{right:auto;left:10px;}
    @media(max-width:576px){
        .card-header{font-size:1rem;padding:.8rem;}
        .iq-score{font-size:2.8rem;}
    }
</style>
</head>
<body>

<div class="lang-selector">
    <select id="langSelect" class="form-select form-select-sm">
        <option value="en">English</option>
        <option value="fr">Français</option>
        <option value="ar">العربية</option>
    </select>
</div>

<div class="container pt-5">

    <!-- Welcome -->
    <div id="welcomeScreen" class="card">
        <div class="card-header"><h3 data-i18n="title">Standard IQ Assessment</h3></div>
        <div class="card-body text-center">
            <h5 class="mb-3" data-i18n="welcome">Welcome to a Scientifically Valid IQ Test</h5>
            <p class="text-muted small mb-3" data-i18n="description">Based on Raven's Matrices – 30 questions – 25-30 min.</p>
            <p class="text-muted small mb-4" data-i18n="results">Age-normed results (16-64) with PDF report.</p>
            <div class="row g-3 mb-4">
                <div class="col-12 col-md-6">
                    <label for="age" class="form-label" data-i18n="ageLabel">Your Age</label>
                    <input type="number" id="age" class="form-control" min="16" max="64" placeholder="28" required>
                </div>
                <div class="col-12 col-md-6">
                    <label class="form-label" data-i18n="genderLabel">Gender (Optional)</label>
                    <select class="form-select">
                        <option data-i18n="male">Male</option>
                        <option data-i18n="female">Female</option>
                        <option data-i18n="preferNot">Prefer not to say</option>
                    </select>
                </div>
            </div>
            <button id="startBtn" class="btn btn-primary" data-i18n="startBtn">Start Test</button>
        </div>
    </div>

    <!-- Test -->
    <div id="testScreen" class="card hidden">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span data-i18n="questionOf">Question <span id="currentQ">1</span>/30</span>
            <span id="timer" class="badge bg-light text-dark">25:00</span>
        </div>
        <div class="question-container">
            <div class="progress mb-3"><div id="progressBar" class="progress-bar" style="width:0%"></div></div>
            <h5 id="questionText" class="mb-3"></h5>
            <div id="questionImage" class="text-center mb-3"></div>
            <div id="optionsContainer" class="mb-4"></div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                <button id="prevBtn" class="btn btn-outline-secondary" disabled data-i18n="prevBtn">Previous</button>
                <button id="nextBtn" class="btn btn-primary" data-i18n="nextBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- Result -->
    <div id="resultScreen" class="hidden">
        <div class="result-card">
            <h3 data-i18n="resultsTitle">Your IQ Results</h3>
            <div class="iq-score" id="iqScore">--</div>
            <p class="percentile" id="percentileText"></p>
            <p class="text-muted small" id="interpretation"></p>
            <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
                <button id="downloadBtn" class="btn btn-primary" data-i18n="downloadBtn">Download PDF</button>
                <button id="retakeBtn" class="btn btn-outline-secondary" data-i18n="retakeBtn">Retake</button>
            </div>
        </div>
    </div>

</div>

<script>
/* ====================  TRANSLATIONS  ==================== */
const translations = {
    en:{title:"Standard IQ Assessment",welcome:"Welcome to a Scientifically Valid IQ Test",description:"Based on Raven's Matrices – 30 questions – 25-30 min.",results:"Age-normed results (16-64) with PDF report.",ageLabel:"Your Age",genderLabel:"Gender (Optional)",male:"Male",female:"Female",preferNot:"Prefer not to say",startBtn:"Start Test",questionOf:"Question",prevBtn:"Previous",nextBtn:"Next",finishBtn:"Finish",resultsTitle:"Your IQ Results",downloadBtn:"Download PDF",retakeBtn:"Retake",alertAge:"Please enter age 16-64.",interpretation:{gifted:"Gifted ({p}th) – Top 2%",verySuperior:"Very Superior ({p}th) – Top 10%",superior:"Superior ({p}th) – Above Avg",average:"Average ({p}th) – Typical",lowAverage:"Low Average ({p}th) – Below Avg",needsSupport:"Needs Support ({p}th) – Seek Help"}},
    fr:{title:"Évaluation QI Standard",welcome:"Bienvenue au Test QI Scientifique",description:"Basé sur Raven – 30 questions – 25-30 min.",results:"Résultats normés par âge (16-64) avec PDF.",ageLabel:"Votre Âge",genderLabel:"Genre (Optionnel)",male:"Homme",female:"Femme",preferNot:"Préfère ne pas dire",startBtn:"Commencer",questionOf:"Question",prevBtn:"Précédent",nextBtn:"Suivant",finishBtn:"Terminer",resultsTitle:"Vos Résultats QI",downloadBtn:"PDF",retakeBtn:"Refaire",alertAge:"Âge 16-64 requis.",interpretation:{gifted:"Surdoté ({p}e) – Top 2%",verySuperior:"Très Supérieur ({p}e) – Top 10%",superior:"Supérieur ({p}e) – Au-dessus",average:"Moyen ({p}e) – Typique",lowAverage:"Inférieur ({p}e) – En dessous",needsSupport:"Besoin d’Aide ({p}e) – Évaluer"}},
    ar:{title:"تقييم الذكاء القياسي",welcome:"مرحباً باختبار ذكاء علمي",description:"مبني على رافن – 30 سؤالاً – 25-30 دقيقة.",results:"نتائج حسب العمر (16-64) مع PDF.",ageLabel:"عمرك",genderLabel:"الجنس (اختياري)",male:"ذكر",female:"أنثى",preferNot:"أفضل عدم الإفصاح",startBtn:"ابدأ",questionOf:"سؤال",prevBtn:"السابق",nextBtn:"التالي",finishBtn:"إنهاء",resultsTitle:"نتائجك",downloadBtn:"PDF",retakeBtn:"إعادة",alertAge:"العمر 16-64 مطلوب.",interpretation:{gifted:"موهوب ({p}) – أعلى 2%",verySuperior:"متفوق جداً ({p}) – أعلى 10%",superior:"متفوق ({p}) – فوق المتوسط",average:"متوسط ({p}) – نمطي",lowAverage:"أقل من المتوسط ({p}) – دون المتوسط",needsSupport:"يحتاج دعماً ({p}) – استشر مختص"}}
};

/* ====================  QUESTIONS (30)  ==================== */
const baseQuestions = [
    // ----- Pattern (visual) – same for every language -----
    {type:"pattern",question:"Which figure completes the pattern?",options:["A","B","C","D","E","F"],correct:2,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-1-1024x576.jpg.webp"},
    {type:"pattern",question:"Identify the missing piece in the sequence:",options:["A","B","C","D","E","F"],correct:4,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-2-1024x576.jpg.webp"},
    {type:"pattern",question:"What comes next in the series?",options:["A","B","C","D","E","F"],correct:0,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-3-1024x576.jpg.webp"},
    {type:"pattern",question:"Which option fits the empty cell?",options:["A","B","C","D","E","F"],correct:3,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-4-1024x576.jpg.webp"},
    {type:"pattern",question:"Complete the matrix:",options:["A","B","C","D","E","F"],correct:1,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-5-1024x576.jpg.webp"},
    {type:"pattern",question:"Find the correct rotation:",options:["A","B","C","D","E","F"],correct:5,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-6-1024x576.jpg.webp"},
    {type:"pattern",question:"Which shape is the odd one out?",options:["A","B","C","D","E","F"],correct:2,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-7-1024x576.jpg.webp"},
    {type:"pattern",question:"Continue the sequence:",options:["A","B","C","D","E","F"],correct:4,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-8-1024x576.jpg.webp"},
    {type:"pattern",question:"What is the relationship between the figures?",options:["A","B","C","D","E","F"],correct:0,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-9-1024x576.jpg.webp"},
    {type:"pattern",question:"Select the correct transformation:",options:["A","B","C","D","E","F"],correct:3,imageUrl:"https://www.iprep.online/wp-content/uploads/2025/05/Raven-Sample-10-1024x576.jpg.webp"},
    // ----- Verbal (translated per language) -----
    {type:"verbal",question:"Which word is most opposite to 'ephemeral'?",options:["Fleeting","Transient","Permanent","Momentary","Brief"],correct:2},
    {type:"verbal",question:"'Doctor' is to 'Patient' as 'Teacher' is to:",options:["Book","School","Student","Classroom","Lesson"],correct:2},
    {type:"verbal",question:"Which word does not belong?",options:["Apple","Banana","Carrot","Orange","Grape"],correct:2},
    {type:"verbal",question:"If 'CAT' = 24, 'DOG' = 26, then 'BIRD' = ?",options:["28","30","32","34","36"],correct:1},
    {type:"verbal",question:"Synonym of 'ubiquitous':",options:["Rare","Omnipresent","Hidden","Scarce","Limited"],correct:1},
    {type:"verbal",question:"Complete: 'Pen is to write as knife is to:'",options:["Cut","Eat","Cook","Sharpen","Hold"],correct:0},
    {type:"verbal",question:"Which is a type of 'fallacy'?",options:["Ad hominem","Metaphor","Hyperbole","Alliteration"],correct:0},
    {type:"verbal",question:"What does 'oxymoron' mean?",options:["Sharp dullness","Wise fool","Jumbo shrimp","All of the above"],correct:3},
    {type:"verbal",question:"If all Bloops are Razzies and all Razzies are Lazzies, then:",options:["All Bloops are Lazzies","Some Bloops are not Lazzies","No Bloops are Razzies","None"],correct:0},
    {type:"verbal",question:"Antonym of 'ameliorate':",options:["Improve","Enhance","Worsen","Better","Refine"],correct:2},
    // ----- Numerical (same for all languages) -----
    {type:"numerical",question:"What is next: 2, 6, 12, 20, 30, ?",options:["42","40","44","36","50"],correct:0},
    {type:"numerical",question:"If 5 workers build 5 walls in 5 days, how many days for 10 workers to build 20 walls?",options:["5","10","20","2.5","4"],correct:0},
    {type:"numerical",question:"Solve: (3³ + 5²) ÷ 4 = ?",options:["13","14","12.5","13.25","14.5"],correct:1},
    {type:"numerical",question:"A train leaves at 2:15 PM and arrives at 5:45 PM. How long was the trip?",options:["3h 30m","3h 15m","4h","3h 45m","2h 30m"],correct:0},
    {type:"numerical",question:"What is 15% of 80?",options:["10","12","15","18","20"],correct:1},
    {type:"numerical",question:"If x + y = 12 and x - y = 4, then x = ?",options:["6","8","7","5","9"],correct:1},
    {type:"numerical",question:"Find the missing number: 1, 4, 9, 16, 25, ?, 49",options:["30","36","32","35","40"],correct:1},
    {type:"numerical",question:"A clock shows 3:15. What is the angle between hands?",options:["0°","7.5°","22.5°","52.5°","97.5°"],correct:1},
    {type:"numerical",question:"If a shirt costs $40 after 20% discount, original price?",options:["$48","$50","$52","$45","$60"],correct:1},
    {type:"numerical",question:"What is the median of: 3, 7, 2, 9, 1, 8, 4?",options:["4","5","6","7","3"],correct:1}
];

/* ----- Language-specific verbal questions (only the 10 verbal ones) ----- */
const verbalFr = [
    "Quel mot est le plus opposé à 'éphémère' ?",
    "'Docteur' est à 'Patient' ce que 'Professeur' est à :",
    "Quel mot ne correspond pas ?",
    "Si 'CHAT' = 24, 'CHIEN' = 26, alors 'OISEAU' = ?",
    "Synonyme de 'ubiquitaire' :",
    "Complétez : 'Stylo est à écrire comme couteau est à :'",
    "Quel est un type de 'sophisme' ?",
    "Que signifie 'oxymore' ?",
    "Si tous les Bloops sont des Razzies et tous les Razzies sont des Lazzies, alors :",
    "Antonyme de 'améliorer' :"
];
const verbalAr = [
    "أي كلمة هي الأكثر عكساً لكلمة 'زائل'؟",
    "'الطبيب' لـ 'المريض' كما 'المعلم' لـ:",
    "أي كلمة لا تنتمي؟",
    "إذا كان 'قط' = 24، 'كلب' = 26، فإن 'طائر' = ؟",
    "مرادف 'منتشر في كل مكان':",
    "أكمل: 'القلم للكتابة كما السكين لـ:'",
    "أي منها نوع من 'المغالطة'؟",
    "ماذا يعني 'التناقض اللفظي'؟",
    "إذا كان كل البلوبس رازيس وكل الرازيس لازيس، فإن:",
    "ضد كلمة 'تحسين':"
];

/* Build final question arrays for each language */
const questions = {
    en: baseQuestions.slice(),
    fr: baseQuestions.map((q,i)=> i<10 ? q : {...q, question:verbalFr[i-10]}),
    ar: baseQuestions.map((q,i)=> i<10 ? q : {...q, question:verbalAr[i-10]})
};

/* ====================  STATE & DOM  ==================== */
let lang='en', qIdx=0, answers=Array(30).fill(null), startTime, timerId, age=null, started=false;

const $ = id => document.getElementById(id);
const dom = {
    langSel:$('langSelect'), start:$('startBtn'), prev:$('prevBtn'), next:$('nextBtn'),
    download:$('downloadBtn'), retake:$('retakeBtn'), ageIn:$('age'),
    welcome:$('welcomeScreen'), test:$('testScreen'), result:$('resultScreen'),
    qNum:$('currentQ'), timer:$('timer'), prog:$('progressBar'),
    qText:$('questionText'), qImg:$('questionImage'), opts:$('optionsContainer')
};

/* ====================  HELPERS  ==================== */
function t(key){                     // translation
    const keys = key.split('.');
    let v = translations[lang];
    for(const k of keys) v = v?.[k];
    return typeof v === 'string' ? v : key;
}
function updateAllText(){           // only text, never touches event listeners
    document.querySelectorAll('[data-i18n]').forEach(el=>el.innerHTML = t(el.dataset.i18n));
    dom.next.textContent = qIdx===29 ? t('finishBtn') : t('nextBtn');
}
function changeLang(l){
    lang = l;
  document.documentElement.lang = l;
  document.body.dir = l==='ar' ? 'rtl' : 'ltr';
    updateAllText();
    if(started) renderQuestion();
}

/* ====================  TEST LOGIC  ==================== */
function startTest(){
    age = parseInt(dom.ageIn.value);
    if(!age||age<16||age>64){alert(t('alertAge'));return;}
    started = true;
    dom.welcome.classList.add('hidden');
    dom.test.classList.remove('hidden');
    startTime = Date.now();
    timerId = setInterval(tick,1000);
    renderQuestion(0);
}
function tick(){
    const elapsed = Math.floor((Date.now()-startTime)/1000);
    const left = 1500 - elapsed;
    if(left<=0){clearInterval(timerId);finish();return;}
    const m = String(Math.floor(left/60)).padStart(2,'0');
    const s = String(left%60).padStart(2,'0');
    dom.timer.textContent = `${m}:${s}`;
}
function renderQuestion(idx=qIdx){
    qIdx = idx;
    const q = questions[lang][idx];
    dom.qNum.textContent = idx+1;
    dom.qText.textContent = q.question;
    dom.prog.style.width = `${((idx+1)/30)*100}%`;
    dom.qImg.innerHTML = q.imageUrl ? `<img src="${q.imageUrl}" class="img-fluid" alt="Pattern">` : '';
    dom.opts.innerHTML = '';
    q.options.forEach((opt,i)=>{
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        if(answers[idx]===i) btn.classList.add('selected');
        btn.innerHTML = `<strong>${String.fromCharCode(65+i)}.</strong> ${opt}`;
        btn.onclick = ()=>select(i,btn);
        dom.opts.appendChild(btn);
    });
    dom.prev.disabled = idx===0;
    dom.next.textContent = idx===29 ? t('finishBtn') : t('nextBtn');
}
function select(i,btn){
    answers[qIdx] = i;
    dom.opts.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
}
function prev(){ if(qIdx>0) renderQuestion(qIdx-1); }
function next(){ qIdx<29 ? renderQuestion(qIdx+1) : finish(); }

function finish(){
    clearInterval(timerId);
    dom.test.classList.add('hidden');
    dom.result.classList.remove('hidden');

    const correct = answers.reduce((s,a,i)=>s+(a===questions[lang][i].correct?1:0),0);
    const bonus = Math.max(0,(1500-(Date.now()-startTime)/1000)/60);
    const raw = correct + bonus*0.5;

    const norm = ageNorms[getAgeGroup(age)];
    const z = (raw-15)/5;
    const iq = Math.round(norm.mean + z*norm.sd);
    const finalIQ = Math.max(70,Math.min(145,iq));
    const perc = Math.round(100*norm.cdf((finalIQ-norm.mean)/norm.sd));

    $('iqScore').textContent = finalIQ;
    $('percentileText').textContent = `${perc}${lang==='fr'?'e':''} percentile`;

    const key = finalIQ>=130?'gifted':finalIQ>=120?'verySuperior':finalIQ>=110?'superior':finalIQ>=90?'average':finalIQ>=80?'lowAverage':'needsSupport';
    $('interpretation').textContent = t(`interpretation.${key}`).replace('{p}',perc);

    window.results = {iq:finalIQ,perc,age,lang};
}

/* ====================  NORMS & PDF  ==================== */
const ageNorms = {
    "16-17":{mean:100,sd:15},"18-24":{mean:100,sd:15},"25-34":{mean:100,sd:15},
    "35-44":{mean:98,sd:14},"45-54":{mean:96,sd:14},"55-64":{mean:94,sd:13}
};
function getAgeGroup(a){ return a<=17?"16-17":a<=24?"18-24":a<=34?"25-34":a<=44?"35-44":a<=54?"45-54":"55-64"; }
Object.keys(ageNorms).forEach(k=>{
    ageNorms[k].cdf = z=>{
        if(z<-4)return 0; if(z>4)return 1;
        const t=1/(1+0.2316419*Math.abs(z));
        const d=0.3989423*Math.exp(-z*z/2);
        let p=d*t*(0.3193815+t*(-0.3565638+t*(1.781478+t*(-1.821256+t*1.330274))));
        return z>0?1-p:p;
    };
});

function generatePDF(){
    const {jsPDF}=window.jspdf, doc=new jsPDF();
    const r=window.results, tr=translations[lang];
    doc.setFontSize(20).setTextColor(67,97,238).text(tr.title,105,20,{align:'center'});
    doc.setFontSize(12).setTextColor(0).text(new Date().toLocaleDateString(),20,40);
    doc.setFontSize(36).setTextColor(67,97,238).text(`${r.iq}`,105,75,{align:'center'});
    doc.setFontSize(14).setTextColor(75,85,99).text("IQ",105,85,{align:'center'});
    doc.setFontSize(12).text($('interpretation').textContent,20,110,{maxWidth:170});
    doc.save(`IQ_${new Date().toISOString().slice(0,10)}.pdf`);
}
function restart(){location.reload();}

/* ====================  INIT  ==================== */
document.addEventListener('DOMContentLoaded',()=>{
    dom.langSel.onchange = e=>changeLang(e.target.value);
    dom.start.onclick = startTest;
    dom.prev.onclick = prev;
    dom.next.onclick = next;
    dom.download.onclick = generatePDF;
    dom.retake.onclick = restart;
    changeLang('en');
});
</script>
</body>
</html>